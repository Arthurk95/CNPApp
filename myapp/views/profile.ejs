<!DOCTYPE html>
<html>
    <head>
        <%- include headerlinks.ejs %>
        <link rel='stylesheet' href='/stylesheets/style.css' />
        <link rel='stylesheet' href='/stylesheets/tabs.css' />
        <link rel='stylesheet' href='/stylesheets/profile.css' />
        <link rel='stylesheet' href='/stylesheets/form.css' />
        <link rel='stylesheet' href='/stylesheets/switch.css' />
        <link rel="stylesheet" href="/stylesheets/prettydropdowns.css">
        
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script src="/javascripts/utilityScripts.js"></script>
        
    </head>
    <body>
      <div class="page-with-sidemenu">
        <div onclick="$(this).toggleClass('active'); toggleBodyOverflow();" class="side-header-mobile-burger">
          <i class="fa fa-bars"></i>
        </div>
        <%- include header.ejs %>
        <div class="content-with-side-header">
          <!-- Profile container -->
          <div class="flex flexColumn flexAlignCenter width100">
            <!-- Picture/name/birthday/schedule -->
            <div class="light-content-BG flex flexAlignCenter width90 flexCollapseMobile marginBottom40 padding10px">
              <!-- Picture -->
              <div class="flex flexCenter width30 width100Mobile minWidth300px">
                <label for="file-input" class="imageContainer tooltip">
                  <div class="edit-image-tooltip">
                    <span class="tooltiptext">Edit Image</span>
                  </div>
                  <img src="/uploads/images/<%- student.Img %>" onerror="this.src='/uploads/images/default.png'">
                </label>
                <form action="<%-student.StudentId%>/upload" method="POST" enctype="multipart/form-data">
                  <div class="file-field input-field hiddenUpload">
                    <input id="file-input" name="student-image-id" type="file" onchange="form.submit()">
                  </div>
                </form>
              </div>
              
              <!-- Name, birthday, schedule -->
              <div class="width60 width100Mobile centerFlexMobile flex flexColumn margin30">
                <h2 class="font40px marginBottom30"><%= student.StudentName %></h2>
                <input id="studentbirthday" value="<%- student.Birthdate %>" style="display: none;"></input>
                
                <div class="flex width100 centerFlexMobile font15px marginBottom30"> <!-- Birthday -->
                  <div class="inputWithIcon width20 white-BG marginRight10">
                    <input id="month" placeholder="MM" maxlength="2"></input>
                  </div>
                  <div class="inputWithIcon width20 white-BG marginRight10">
                    <input id="day" placeholder="DD" maxlength="2"></input>
                  </div>
                  <div class="inputWithIcon width30 white-BG">
                    <input id="year" placeholder="YYYY" maxlength="4"></input>
                  </div>
                </div> <!-- End birthday -->

                <ul id="schedule" class="selectableList flexWrap width100 flexCenter marginBottom40">
                  <li id="mon" value="<%- student.Monday %>" onclick="weekdaySelected(this)"><a>M</a></li>
                  <li id="tue" value="<%- student.Tuesday %>" onclick="weekdaySelected(this)"><a>T</a></li>
                  <li id="wed" value="<%- student.Wednesday %>" onclick="weekdaySelected(this)"><a>W</a></li>
                  <li id="thu" value="<%- student.Thursday %>" onclick="weekdaySelected(this)"><a>TH</a></li>
                  <li id="fri" value="<%- student.Friday %>" onclick="weekdaySelected(this)"><a>F</a></li>
                </ul>

                <div class="flex spaceBetween flexWrap centerFlexMobile flexCollapseMobile font20px centerText light-text marginBottom20 width100Mobile">
                  <div onclick="window.location.href = '/admin'" class="buttonWithIcon padding8px15px">
                    <p>Back to Admin</p>
                  </div>

                  <div onclick="deleteStudent(this)" class="buttonWithIcon theme-color4-light-BG padding8px15px">
                    <p>Delete Student</p>
                  </div>
                  <div onclick="saveStudent()" class="buttonWithIcon theme-color2-light-BG padding8px15px">
                    <p>Save Changes</p>
                  </div>
                </div>

                <div class="centerText marginTop20">
                  <form action="<%-student.StudentId%>/delete-student" id="delete-student-form" method="POST">
                    <label><font color="green"><%- messages.upload_successful %></font></label>
                    <label><font color="green"><%- messages.changes_saved %></font></label>
                    <label><font color="red"><%- messages.changes_error %></font></label>
                    <label><font color="red"><%- messages.upload_error %></font></label>
                  </form>
                </div>
                
                
              </div><!-- End name/birthday/schedule -->
            </div> <!-- End picture/name/birthday/schedule  -->

            <!-- Info Panels -->
            <div class="flex spaceBetween flexCollapseMobile width90 center">
              <!-- Guardians -->
              <div id="infoPanel" class="mobilePanel margin10 borderRadiusSmall hideOverflow minWidth450px width60 light-content-BG width100Mobile">
                <div class="flexContainer spaceAround flexWrap heavyPadding">
                  <ul class="width40 width100Mobile marginBottom30 marginBelowChildren10">
                    <li class="dark-text largeFont marginBottom10">Guardian #1</li>
                    <li><input name="guardian1Name" type="text" id="guardian1Name" placeholder="Guardian Name" value="<%- student.RelativeName %>"></li>
                    <li><input name="guardian1Email" type="text" id="guardian1Email" placeholder="Guardian Email" value=<%- student.RelativeEmail %>></li>
                    <li><input name="guardian1Number" type="text" id="guardian1Number" placeholder="Guardian's Phone Number" value=<%- student.RelativePhone %>></li>
                  </ul>
    
                  <ul class="width40 width100Mobile marginBelowChildren10">
                    <li class="dark-text largeFont">Guardian #2</li>
                    <li><input name="guardian2Name" type="text" id="guardian2Name" placeholder="Guardian Name" value="<%- student.RelativeName2 %>"></li>
                    <li><input name="guardian2Email" type="text" id="guardian2Email" placeholder="Guardian Email" value=<%- student.RelativeEmail2 %>></li>
                    <li><input name="guardian2Number" type="text" id="guardian2Number" placeholder="Guardian's Phone Number" value=<%- student.RelativePhone2 %>></li>
                  </ul>
                </div>
              </div> <!-- End Guardians -->

              <!-- -------------------- EXTRA INFO PANEL --------------------- -->
              <div id="extraInfoPanel" class="mobilePanel width35 light-content-BG borderRadiusSmall hideOverflow margin10 width100Mobile">
                <div class="flexContainer flexColumn spaceAround flexWrap heavyPadding">
                  <div class="flex flexColumn width100 marginBottom30">
                    <p>Allergies</p>
                    <textarea id="allergies"><%= student.Allergies %></textarea>
                  </div>
                  <div class="flex flexColumn width100">
                    <p>Special Accommodations</p>
                    <textarea id="accommodations"><%= student.Accommodation %></textarea>
                  </div>
                </div>
              </div> <!-- End extra info panel-->
            </div> <!-- End info panels -->
          </div> <!-- End profile container -->
        </div> <!-- End side header content container -->
      </div> <!-- End page with side menu container -->
    </body>
  
    <script>
      var days = document.getElementById("schedule").getElementsByTagName("li");
      var length = days.length;

      // Sets days that are selected to selected in the Schedule tab
      $(document).ready(function(){
        for (var i = 0; i < length; i++){
          val = days[i].getAttribute("value");
          console.log(val);
          if(val == 1){
            days[i].classList.add("full-day");
          }
          else if(val == 2){
            days[i].classList.add("half-day");
          }
        }  

        var birthday = new Date(document.getElementById('studentbirthday').value);
        document.getElementById('month').value = birthday.getMonth() + 1;
        document.getElementById('day').value = birthday.getDate();
        document.getElementById('year').value = birthday.getFullYear();
      });



      function saveStudent(){
        
        var data = 
          `studentName=${document.getElementById('studentName').value}` +
          `&mon=${selectedDayType(document.getElementById("mon"))}` +
          `&tue=${selectedDayType(document.getElementById("tue"))}` +
          `&wed=${selectedDayType(document.getElementById("wed"))}` +
          `&thu=${selectedDayType(document.getElementById("thu"))}` +
          `&fri=${selectedDayType(document.getElementById("fri"))}` +
          `&fullDayFlag=${0}` +
          `&birthdate=${document.getElementById("year").value}/${document.getElementById("month").value}/${document.getElementById("day").value}` +
          `&guardian1Name=${document.getElementById('guardian1Name').value}` +
          `&guardian1Email=${document.getElementById('guardian1Email').value}` +
          `&guardian1Number=${document.getElementById('guardian1Number').value}` +
          `&guardian2Name=${document.getElementById('guardian2Name').value}` +
          `&guardian2Email=${document.getElementById('guardian2Email').value}` +
          `&guardian2Number=${document.getElementById('guardian2Number').value}` +
          `&allergies=${document.getElementById('allergies').value}` +
          `&accommodations=${document.getElementById('accommodations').value}`;
        
        httpPostAsync(`${window.location.href}/save-changes`, data, reloadIt);

      }

      function deleteStudent(button){
        if(button.classList.contains("deleteButtonConfirm")){
          form = document.getElementById("delete-student-form");
          form.submit();
        }

        else {
          button.classList.add("deleteButtonConfirm");
          button.innerHTML = "Are you sure?";
        }


        window.onclick = function(event) {
          if (event.target != button) {
            button.classList.remove("deleteButtonConfirm");
            button.innerHTML = "Delete Student";
          }
        }
      }

      function loadCheckBox(checkBox, val){
        if(val == 1){
          checkBox.checked = true;
        }
        else checkBox.checked = false;
      }
    </script>
    
</html>
