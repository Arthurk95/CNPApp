<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<html>

  <head>
    <nav><%- include header.ejs %></nav>
    <meta charset="utf-8">
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel='stylesheet' href='/stylesheets/stats.css' />
    <link rel='stylesheet' href='/stylesheets/charts.css' />
    <link rel='stylesheet' href='/stylesheets/admin-styling.css' />
    <link rel='stylesheet' href='/stylesheets/custom-table.css' />
    <link rel='stylesheet' href='/stylesheets/blockList.css' />
    <link rel='stylesheet' href='/stylesheets/footer.css' />
    <link rel='stylesheet' href='/stylesheets/accordian.css' />
    <link rel='stylesheet' href='/stylesheets/tabs.css' />
    <link rel='stylesheet' href='/stylesheets/form.css' />
    <link rel='stylesheet' href='/stylesheets/switch.css' />
    <link rel='stylesheet' href='/stylesheets/ulList.css' />
    <link rel='stylesheet' href='/stylesheets/checkbox.css' />
    <link rel="stylesheet" href="/stylesheets/prettydropdowns.css">

    <script src="/javascripts/utilityScripts.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="/javascripts/jquery.prettydropdowns.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script src="https://www.chartjs.org/samples/latest/utils.js"></script>
    <script async="" src="//www.google-analytics.com/analytics.js"></script>
   
    <!-- Load d3.js -->
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/d3.v3.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3.v5.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

    <!-- Color scale -->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

  </head>

  <body>

    <!-- Navigation -->
    <div class="headerStyle2" id ="navigation">
      <nav class="navbar-expand-lg">
        <span class="navbar-brand">CNP Statistics</span>

          <!-- Month selection -->
          <ul class="navbar-nav">
            <li class="nav-item">
              <div class="float-right">
                <form>
                  <input id="hiddenstartDate" value="<%- startDate %>" style="display: none;">
                  <script>
                    var activityList = JSON.parse('<%- activities %>');
                    var studentList = JSON.parse('<%- students %>');
                  </script>
                </form>
              </div> <!-- end month selection-->
            </li>
          </ul>
        </div>
      </nav>
    </div> <!-- end navigation -->

    <!-- Drop down for adding a enw chart -->
    <div id="charts">
      <select id="newchart" class="pretty-classic">
        <option>Pie Chart</option>
        <option>Line Chart</option>
        <option>Radar Chart</option>
        <option>Bubble Chart</option>
        <option>Bar Chart</option>
      </select>
      <ul id="selectionButtons" class="selectionButtons">
      <li><a id="studentButton" class="accent2Light-BG" onclick="makeChart()">Add a New Chart</a></li></ul>
      </div>

      <script>
        var chartArray = [];
        var curId = 0;
        function makeChart(){
          var id = "chartObject" + curId;
          var selected = document.getElementById("newchart").selectedIndex;
          if(selected == 0) {
            generatePie(id);
            let pie1 = new thePie(id);
            chartArray.push(pie1);
            curId = curId + 1;
            
            
          }
          else {
      
          }
          
        };
      </script>

    
    <!-- LINE CHART -->
    <div class="chart" id="line">
      <h1>Line Chart</h1>
      <!-- Make a line chart -->
      <!-- Doesn't work -->
      <button onclick="makeLine('#line')">Make Line</button>
      <script>
        function makeLine(id){
          console.log("make a line chart");
        }
      </script>
      <!-- this just makes one line chart -->
      <canvas id="line-chart"></canvas>
    </div> <!-- end Line -->

    <!-- SCATTER PLOT -->
    <div class="chart" id="scatter">
      <h1>Scatter Plot</h1>
      <!-- Make a scatter chart -->
      <!-- Doesn't work -->
      <button onclick="makeScatter('#scatter')">Make Scatter</button>
      <script>
        function makeScatter(id){
          console.log("make a scatter chart");
        }
      </script>
      <!-- this just makes one scatter chart -->
      <canvas id="scatter-chart"></canvas>
      <!-- randomize some data just as proof of concept -->
      <button id="randomizeData">Randomize Data</button>
    </div> <!-- end Scatter -->

    <!-- RADAR CHART --> 
    <div class="chart" id="radar">
      <h1>Radar Chart</h1>
    <!-- Make a radar chart -->
    <!-- Doesn't work -->
      <button onclick="makeRadar('#radar')">Make Radar</button>
      <script>
        function makeRadar(id){
          console.log("make a radar chart");
        }
      </script>
      <!-- this just makes one radar chart -->
    <canvas id="radar-chart"></canvas>
    </div> <!-- end Radar -->

    <!-- Bubble Chart -->
    <div class="chart" id="bubble"> 
      <h1>Bubble Chart</h1>

      <!-- Make a bar chart -->
      <!-- Doesn't work -->
      <button onclick="makeBubble('#bubble')">Make Bubble</button>
      <script>
        function makeBubble(id){
          console.log("make a bubble");
        }
      </script>
      <!-- this just makes one bar chart -->
      <canvas id="bubble-chart"></canvas>
    </div>

    <!-- Another Chart --> 
    <div class="chart" id="bar"> 
      <h1>Bar Chart</h1>
      <!-- Make a bar chart -->
      <!-- Doesn't work -->
      <button onclick="makeBar('#bar')">Make Bar</button>
      <script>
        function makeBar(id){
          console.log("its trying to make a bar at least");
        }
      </script>
      <!-- this just makes one bar chart -->
      <canvas id="bar-chart"></canvas>
    </div>
    

    <!-- Records and Data -->
    <script>
      
      function getRecords(weather, caller){
        var today = new Date();
        var selection = document.getElementById('option1' + caller).options[document.getElementById('option1' + caller).selectedIndex].text;
        var beta = document.getElementById('option2' + caller).options[document.getElementById('option2' + caller).selectedIndex].text;
        var id = document.getElementById('optionid1' + caller).options[document.getElementById('optionid1' + caller).selectedIndex].value;
        console.log(id);
        var start = document.getElementById('syear'+caller).value + '-' + document.getElementById('smonth'+caller).value + '-' + document.getElementById('sday'+caller).value;
        var end = document.getElementById('eyear'+caller).value + '-' + document.getElementById('emonth'+caller).value + '-' + document.getElementById('eday'+caller).value;
        theUrl = window.location.href+'/getdata';
        data = "id=" + id + "&prime=" + selection + "&beta=" + beta + "&weather=" + weather + "&start=" + start + "&end=" + end + "&caller=" + caller;
        callback = gotData; 
        httpPostAsync(theUrl,data,callback); 
      }
      function gotData(data){
        data = JSON.parse(data);
        var datum = [];
        var id;
        data.forEach((element) => {
          if(element.activityName == null){
            id = element.caller;
          }
          else{
            datum[element.activityName] = element.value;
          }
        }); 
        var object = document.getElementById(id);
       chartArray.forEach((chart) => {
          if(chart.myId == id){
            chart.update(datum);
          }
        });
      }
      
      function makeDates(id){
        
        var date = new Date();
        var moreThanZero = false;
        var startdate = document.getElementById('hiddenstartDate').value;
        startdate = (new Date(startdate)).getFullYear();
        var yearDrop = document.getElementById('syear' + id);

        // for if a birthday dropdown exist
        for(var i = 0; date.getFullYear() - i >= startdate; ++i){
            var option = document.createElement("option");
            option.text = date.getFullYear() - i;
            if(i == 1) {
              option.selected = true;
              moreThanZero = true;
            }

            yearDrop.appendChild(option);
        }
        if(moreThanZero) {
          document.getElementById('smonth' + id).selectedIndex = date.getMonth();
        }
        sgenDays(id);
        if(moreThanZero) {
          document.getElementById('sday' + id).selectedIndex = date.getMonth() - 1;
        }

        var yearDrop = document.getElementById('eyear' + id);
        
        // for if a birthday dropdown exist
        for(var i = 0; date.getFullYear() - i >= startdate; ++i){
            var option = document.createElement("option");
            option.text = date.getFullYear() - i;
            yearDrop.appendChild(option);
        }

        document.getElementById('emonth' + id).selectedIndex = date.getMonth();
        egenDays(id);
        
        document.getElementById('eday' + id).selectedIndex = date.getDate() - 1;
      }

      function sgenDays(id){
        var months = document.getElementById('smonth' + id);
        var month = months.options[months.selectedIndex].value;
        var years = document.getElementById('syear' + id);
        var year = years.options[years.selectedIndex].text;
        var day = document.getElementById('sday' + id);
        month = new Date(Date.parse(month +" 1, 2012")).getMonth()+1
        var daysinmonth = new Date(year, month, 0).getDate();
        $(day).empty();
        for(var i = 1; i <= daysinmonth; ++i){
            var option = document.createElement("option");
            option.text = i;
            option.value = i;
            day.appendChild(option);
        }
      }

      function egenDays(id){
        var months = document.getElementById('emonth' + id);
        var month = months.options[months.selectedIndex].value;
        var years = document.getElementById('eyear' + id);
        var year = years.options[years.selectedIndex].text;
        var day = document.getElementById('eday' + id);
        month = new Date(Date.parse(month +" 1, 2012")).getMonth()+1
        var daysinmonth = new Date(year, month, 0).getDate();
        $(day).empty();
        for(var i = 1; i <= daysinmonth; ++i){
            var option = document.createElement("option");
            option.text = i;
            option.value = i;
            day.appendChild(option);
        }
      }
    </script><!-- End Records and Data -->

    <!-- bootstrap -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <!-- local javascript -->
    <script type="text/javascript" src="javascripts/statscripts/pie.js"></script>
    <script type="text/javascript" src="javascripts/statscripts/line-chart.js"></script>
    <script type="text/javascript" src="javascripts/statscripts/navigation.js"></script>
    <script type="text/javascript" src="javascripts/statscripts/radar-chart.js"></script>
    <script type="text/javascript" src="javascripts/statscripts/bar-chart.js"></script>
    <script type="text/javascript" src="javascripts/statscripts/bubble-chart.js"></script>
    <script type="text/javascript" src="javascripts/statscripts/scatter-chart.js"></script>
  </body>

  <script>
    $( function() {
      $( "#accordion" ).accordion({
        collapsible: true,
        active: false
      });
    } );
  </script>
  <script>
    $dropdown = $('.pretty-classic').prettyDropdown({
        classic: true,
        height: 50,
        width: '10%',
        customClass: 'arrow mediumFontSize margins',
        hoverIntent: -1
      });
    // Get the modal
    var formElement;

    // opens student profile in same tab when a student is clicked
    function studentSelected(studentID){
      window.location.href ="/admin/student-profile/" + studentID;
    }

    // Get the <span> element that closes the modal
    var closeButton = document.getElementsByClassName("close");

    // When the user clicks on the button, open the modal
    function addStudent() {
      formElement = document.getElementById("newStudentForm");
      formElement.style.display = "block";
    }

    function addActivity(){
      formElement = document.getElementById("newActivityForm");
      formElement.style.display = "block";
    }

    function addTask(){
      formElement = document.getElementById("newTaskForm");
      formElement.style.display = "block";
    }


    function hideActivity(element, id, hidden){
      if(hidden){
        theUrl = window.location.href+'/unhideactivity';
      }
      else{ theUrl = window.location.href+'/hideactivity'; }
      data = "id=" + id;
      toggleActivityHide(element.parentElement)
      callback = doNothing;

      httpPutAsync(theUrl, data, callback);
    }

    function toggleActivityHide(element){
      if(element.getElementsByClassName("blackAndWhite").length > 0){
        $(element).find('*').removeClass('blackAndWhite');
      }
      else{
        $(element).find('*').addClass('blackAndWhite');
      }
    }

    function editActivity(id, oldName){
      //take new input
      formElement = document.getElementById("editActivityForm");
      formElement.style.display = "block";
      formElement.querySelector("#editActivityID").innerHTML = id;
      formElement.querySelector("#editActivityInput").value = oldName;
    }

    function passEditActToPost(){
      var actID = formElement.querySelector("#editActivityID").innerHTML;
      var newName = formElement.querySelector("#editActivityInput").value;

      editActivityPost(actID, newName);
    }

    function editActivityPost(id,name){
      theUrl = window.location.href+'/editactivity';
      data = "id=" + id + "&name=" + name;
      callback = reloadIt;

      httpPutAsync(theUrl, data, callback);
    }

    function deleteActivity(element){
      theUrl = window.location.href+'/deleteactivity';
      data = "id=" + element;
      callback = reloadIt;

      httpPostAsync(theUrl, data, callback);
    }

    // When the user clicks anywhere outside of the form window, close it
    window.onclick = function(event) {
      if (event.target == formElement) {
        formElement.style.display = "none";
      }
    }


    //generate perameters for post and call post
    function callPostStu(){
      var theUrl = window.location.href+'/addstudent';
      var fullDay = convertBoolToInt(document.getElementById("fullDay").checked);
      birthday = getSelectedBirthday();

      var data = 
      "name=" + document.getElementById("newStudentName").value + 
      "&contact=" + document.getElementById("newStudentContact").value + 
      "&email=" + document.getElementById("newStudentEmail").value + 
      "&contactNum=" + document.getElementById("newStudentContactNumber").value + 
      "&contact2=" + document.getElementById("newStudentContact2").value + 
      "&email2=" + document.getElementById("newStudentEmail2").value + 
      "&contactNum2=" + document.getElementById("newStudentContactNumber2").value + 
      "&birthday=" + birthday + 
      "&sun=" + 0 + 
      "&mon=" + isDaySelected("mon") + 
      "&tue=" + isDaySelected("tue") + 
      "&wed=" + isDaySelected("wed") + 
      "&thu=" + isDaySelected("thu") + 
      "&fri=" + isDaySelected("fri") + 
      "&sat=" + 0 + 
      "&halfDay=" + fullDay + 
      "&enroll=" + 1 ;
      var callback = reloadIt;

      httpPostAsync(theUrl, data, callback);
    }

    function callPostAct(){
      var helper = convertBoolToInt(document.getElementById("helper").checked);
      theUrl = window.location.href+'/addactivity';
      data = "name=" + document.getElementById("newActivityName").value +
            "&helper=" + helper;
      callback = reloadIt;

      httpPostAsync(theUrl, data, callback);
    }

    function changePriority(task,cur) {
      theUrl = window.location.href+'/changetask';
      data = "id=" + task + "&priority=" + (cur + 1) % 3;
      callback = reloadIt; 
      httpPutAsync(theUrl,data,callback);  
    }


    function getSelectedBirthday(){
      var years = document.getElementById('year');
      var year = years.options[years.selectedIndex].text;
      var months = document.getElementById('month');
      var month = months.options[months.selectedIndex].value;
      var days = document.getElementById('day');
      var day = days.options[days.selectedIndex].text;

      return (year + '/' + month + '/' + day);
    }

    function addTaskPost(){
      var theUrl = window.location.href+'/addtask';
      var data = "name=" + document.getElementById("newTaskName").value +
      "&priority=" +  document.getElementById("newTaskPriority").value;
      var callback = reloadIt;
      httpPostAsync(theUrl,data,callback);
    }

    function deleteTask(task) {
      var helper = convertBoolToInt(document.getElementById("helper").checked);
      theUrl = window.location.href+'/deletetask';
      data = "id=" + task;
      callback = reloadIt;

      httpPostAsync(theUrl, data, callback);
    }
    function taskComplete(element, task){
      checkboxClicked(element);
      $(element.parentElement.getElementsByTagName("button")).animate({width:'toggle'},200);
      $(element.parentElement.getElementsByTagName("p")).animate({color: "#EEEEEE"},200);

      $(element.parentElement).animate({backgroundColor: "#5E895F"}, 200);

      
      setTimeout(function(){
        $(element.parentElement).slideUp("fast");
        $(element).animate({bottom: "200px"}, 100);
        //element.parentElement.style.display = "none";
      }, 500);

      theUrl = window.location.href+'/completetask';
      data = "id=" + task + "&completed=" + 1;
      callback = reloadIt; 
      httpPutAsync(theUrl,data,callback); 

    }
  </script>


</html>
