<!DOCTYPE html>
<html>
    <nav><%- include header.ejs %></nav>
    <head>
        <link rel='stylesheet' href='/stylesheets/style.css' />
        <link rel='stylesheet' href='/stylesheets/emailer.css' />
        <link rel='stylesheet' href='/stylesheets/form.css' />
        <link rel='stylesheet' href='/stylesheets/ulList.css' />
        <link rel='stylesheet' href='/stylesheets/editor.css' />
        <link rel="stylesheet" href="//cdn.quilljs.com/1.3.6/quill.snow.css">

        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        
        <script src="/javascripts/emailerScripts.js"></script>
        <script src="/javascripts/utilityScripts.js"></script>

        <script>
            function fillSelect(id, list){
                var op = 'op';
                var select = document.getElementById(id).getElementsByTagName("select")[0];
                var len = Object.keys(list).length;
                for(var i = 0; i < len; i++){
                    var option = document.createElement("option");
                    if(i == 0){
                        select.append(option);
                    }
                    else{
                        op = 'op' + i;
                        option.text = list[op]; 
                        select.appendChild(option);
                    }
                }
            }
            
        </script>

    </head>
    <body>
        <div id="mainEmailerContainer" class="flexContainer spaceAround flexAlignCenter">
            <i id="backButton" onclick="toPreviousStep()" class="fas fa-chevron-left icon hugeFont hoverable displayNone"></i>
            <div id="stepOne" class="flexCenter flexColumn borderBox lightGray1-BG borderRadiusMedium width80">
                <p class="title accent2-BG">Step 1: Email Template</p>
                <div class="veryHeavyPadding">
                    <ul class="flex flexColumn">
                        <li class="marginBottom10">
                            <label for="summary">Summary</label>
                            <div id="summary">
                                <p><%- summary %></p>
                            </div>
                        </li>
                        <li class="marginBottom10">
                            <label for="snack">AM Snack</label>
                            <div id="snack">
                                <p><%- snack %></p>
                            </div>
                        </li>
                        <li class="marginBottom10">
                            <label for="lunch">Lunch</label>
                            <div id="lunch">
                                <p><%- lunch %></p>
                            </div>
                        </li>
                    </ul>
                    <!-- Create the editor container -->
                    

                    <div id="remindersContainer" class="flexContainer borderRadiusMedium marginTop30 relative flexColumn flexCenter border1px darkGray3-border lightGray1-BG heavyPadding width40">          
                        <div class="flex spaceBetween marginBottom10 width100 flexAlignCenter">
                            <p class="mediumFont noMargin darkText">Reminders</p>
                            <a class="addReminder" onclick="addReminder()"><i class="fas fa-plus"></i></a>
                        </div>
                        <ul id="reminders" class="flex flexColumn spaceBetween width100">

                        </ul>
                    </div>
                </div>
            </div>

            <div id="stepTwo" class="contentWithSidebar displayNone">
                <div class="width70 lightGray1-BG borderRadiusMedium"> <!-- Left column -->
                    <div id="stepTwoTitle" class="title accent1Light-BG flex spaceBetween">
                        <p></p>
                        <div class="stepButton green2-BG" onclick="openReview()">
                            <p>Review</p>
                        </div>
                    </div>

                    <!-- Review Form -->
                    <div id="reviewForm" class="formWindow">
                        <div class="formWindow-content flexContainer width60 width90Mobile">
                            <span class="close" onclick="closeForm()">&times;</span>
                            <p class="font50px marginBottom40 centerText accent2Light-text">Review</p>
                            <div class="flex flexColumn flexCenter center flexAlignCenter marginBelowChildren10 width90">
                                <textarea class="width100" placeholder="Entire email will go here"></textarea>
                            </div>
                            <div class="flex flexCenter">
                                <a class="formSubmitButton flexGrow1 maxWidth600px" onclick="studentApproved(this)">Approve</a>
                            </div>
                            
                        </div>
                    </div>

                    <div class="content"> <!-- activities and dropdowns -->
                        <div class="flex spaceBetween">
                            <div id="activities" class="width60">
                                <p class="mediumFont darkText marginBottom20">Activities</p>
                                <ul id="activitiesList" class="ulList darkText width50"></ul>
                            </div>

                            <!-- Behavior dropdowns -->
                            <div id="" class="flex flexColumn flexCenter heavyPadding width70">
                                <% behaviors.forEach((behavior, index) => { %>
                                    <div id="<%= behavior.name %>" class="flex flexAlignCenter spaceBetween marginBottom10 flexWrap">
                                        <label for="<%= behavior.name %>"><%= behavior.name %></label>
                                        
                                        <div class="flex spaceAround">
                                            <select name="<%= behavior.name %>" class="width20">
                                            </select>
                                            <a onclick="openForm('<%= behavior.name %>Form')" class="marginLeft10 borderRadiusSmall accent4Light-BG lightPadding">
                                                <i class="fas fa-sticky-note darkText"></i>
                                            </a>
                                        </div>
                                        <!-- <textarea id="<%=behavior.name %>-text-box" placeholder="<%=behavior.name %> Notes..."></textarea> -->
                                        <!-- if we want a text box to the right instead, will work just the same right away once un-commented -->
                                    </div>

                                    <!-- Add note behavior forms -->
                                    <div id="<%= behavior.name %>Form" class="formWindow">
                                        <div class="formWindow-content width500px width90Mobile flexContainer">
                                            <span class="close" onclick="closeForm()">&times;</span>
                                            <p class="font50px marginBottom40 centerText accent2Light-text"><%= behavior.name %></p>
                                            <div class="flex flexColumn flexCenter center flexAlignCenter marginBelowChildren10 width80 width90Mobile">
                                                <textarea class="width100" id="<%=behavior.name %>-text-box" placeholder="<%=behavior.name %> notes.."></textarea>
                                            </div>
                                            <!-- <div class="flex flexCenter">
                                                <a class="formSubmitButton flexGrow1 maxWidth600px" onclick="behaviorNote(this)">Save Note</a>
                                            </div> -->
                                            
                                        </div>
                                    </div>

                                    <script>fillSelect('<%= behavior.name %>', <%- JSON.stringify(behavior) %>);</script>
                                        
                                <% }) %>
                            </div>
                        </div>
                        <div class="flexContainer flexRight">
                            <div id="saveButton" class="stepButton blue2-BG" onclick="studentSaved(<%= JSON.stringify(behaviors) %>);">
                                <p>Save</p>
                                <div class="buttonIcon blue3-BG">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right column (students) -->
                <div class="sidebar width20 lightGray1-BG">
                    <ul id="listOfStudents" class="studentsList maxHeight500px" >
                    <% if (reports.length > 0) { %>
                        <script>passToJS(<%- JSON.stringify(reports) %>);</script>
                        <% reports.forEach((report, index) => { %>
                            <li id="student<%= index %>" onclick="studentSelected(this, <%= JSON.stringify(report) %>, <%= index %>)"><%= report.name %></li>
                        <% }) %>
                    <% } else { %>
                        <li>No Students</li>
                    <% } %>
                    </ul>
                    <div id="sendEmailButton" class="stepButton center marginBottom20 accent2-BG">
                        <p class="centerText lightPadding">Send Emails</p>
                    </div>
                </div>
                    
            </div>

            <i onclick="toNextStep()" id="nextButton" class="fas fa-chevron-right icon hugeFont hoverable"></i>
        </div>
        <script>initEmailerVariables();
        
        $(document).ready(function(){
            $('select').selectmenu();
        })
            
        </script>

        <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
        <script>
            var summaryQuill = new Quill('#summary', {
                theme: 'snow'
            });
            var snackQuill = new Quill('#snack', {
                theme: 'snow'
            });
            var lunchQuill = new Quill('#lunch', {
                theme: 'snow'
            });
            var lunchQuill = new Quill('#review', {
                theme: 'snow'
            });
        </script>

        <script>
            var listOfReminders = <%- JSON.stringify(reminders) %>;
            var numRemindersShown = 0;
            function addReminder(){
                numRemindersShown++;
                var reminders = document.getElementById('reminders');
                var select = document.createElement("select");
                for(var i = 0; i < listOfReminders.length; i++){
                    var option = document.createElement("option");
                    option.text = listOfReminders[i].title;

                    select.appendChild(option);
                }

                var label = document.createElement("label");
                label.innerHTML = "Reminder " + numRemindersShown;
                label.classList = "darkText";
                var li = document.createElement("li");
                li.classList = "flex spaceBetween flexAlignCenter lightPadding";
                li.appendChild(label);
                li.appendChild(select);
                reminders.appendChild(li);
                
                $('select').selectmenu();
            }

            function behaviorNote(behavior){
                console.log(behavior);
            }

            // When the user clicks anywhere outside of the form window, close it
            window.onclick = function(event) {
                if (event.target == formElement) {
                    formElement.style.display = "none";
                }
            }
        </script>
        
        <script>
            //template functions (page 1)
            function pushSummary(summary_element) {
                theUrl = window.location.href + '/push-summary';
                data = "text=" + summary_element.value;
                httpPostAsync(theUrl, data, null);
            }

            function pushAmSnack(am_snack_element) {
                theUrl = window.location.href + '/push-am-snack';
                data = "text=" + am_snack_element.value;
                httpPostAsync(theUrl, data, null);
            }

            function pushLunch(lunch_element) {
                theUrl = window.location.href + '/push-lunch';
                data = "text=" + lunch_element.value;
                httpPostAsync(theUrl, data, null);
            }
        </script>
    </body>
</html>