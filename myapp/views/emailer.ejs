<!DOCTYPE html>
<html>
    <nav><%- include header.ejs %></nav>
    <head>
        <link rel='stylesheet' href='/stylesheets/style.css' />
        <link rel='stylesheet' href='/stylesheets/emailer.css' />
        <script src="/javascripts/emailerScripts.js"></script>
        <script src="/javascripts/utilityScripts.js"></script>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        

        <script>
            function fillSelect(id, list){
                var op = 'op';
                var select = document.getElementById(id).getElementsByTagName("select")[0];
                var len = Object.keys(list).length;
                for(var i = 0; i < len; i++){
                    var option = document.createElement("option");
                    if(i == 0){
                        select.append(option);
                    }
                    else{
                        op = 'op' + i;
                        option.text = list[op]; 
                        select.appendChild(option);
                    }
                }
            }
            
        </script>

    </head>
    <body>
        <div id="mainEmailerContainer" class="emailerContainer flex spaceAround">
            <div  class="sideButton" onclick="toPreviousStep()"><i id="backButton" class="fas fa-chevron-left"></i></div>
            <div id="stepOne" class="flexCenter flexColumn borderBox lightGray2-BG borderRadiusMedium shadowMedium width80">
                <p class="title green4-BG">Step 1: Email Template</p>

                <div class="veryHeavyPadding">
                    <ul class="flex flexColumn">
                        <li class="marginBottomSmall">
                            <label for="summary">Summary</label>
                            <textarea onkeyup="textAreaAdjust(this)" name="summary"></textarea>
                        </li>
                        <li class="marginBottomSmall">
                            <label for="amSnack">AM Snack</label>
                            <textarea onkeyup="textAreaAdjust(this)" name="amSnack"></textarea>
                        </li>
                        <li class="marginBottomSmall">
                            <label for="lunch">Lunch</label>
                            <textarea onkeyup="textAreaAdjust(this)" name="lunch"></textarea>
                        </li>
                    </ul>

                    <div id="remindersContainer" class="flexContainer borderRadiusMedium marginTop relative flexColumn flexCenter border1px darkGray3-border lightGray1-BG heavyPadding width40">          
                        <div class="flex spaceBetween marginBottom width100 flexAlignCenter">
                            <p class="mediumFont noMargin darkText">Reminders</p>
                            <a class="addReminder" onclick="addReminder()"><i class="fas fa-plus"></i></a>
                        </div>
                        <ul id="reminders" class="flex flexColumn spaceBetween width100">

                        </ul>
                    </div>
                </div>
                
            </div>

            <div id="stepTwo" class="flex spaceAround displayNone width100">
                <div class="width70 lightGray2-BG borderRadiusMedium"> <!-- Left column -->
                    <div class="relative title blue2-BG flex spaceBetween">
                        <p id="stepTwoTitle" class=""></p>
                        <div class="stepButton green2-BG" onclick="studentApproved(this)">
                            <p>Approve</p>
                            <div class="buttonIcon green3-BG">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="heavyPadding"> <!-- activities and dropdowns -->
                        <div class="flex spaceBetween">
                            <div id="activities" class="width60">
                                <p class="listTitle">Activities</p>
                                <ul id="activitiesList" class="activitiesList">
                                    
                                </ul>
                            </div>

                            <div id="" class="flex flexColumn flexCenter heavyPadding">
                                <% behaviors.forEach((behavior, index) => { %>
                                    <div id="<%= behavior.name %>" class="flex flexAlignCenter spaceBetween marginBottomSmall">
                                        <label for="<%= behavior.name %>"><%= behavior.name %></label>
                                        <select name="<%= behavior.name %>" class="pretty-classic">
                                        </select>
                                        
                                    </div>
                                    <script>fillSelect('<%= behavior.name %>', <%- JSON.stringify(behavior) %>);</script>
                                        
                                <% }) %>
                            </div>
                        </div>
                    </div>

                    <div class="flexContainer flexRight">
                        <div class="stepButton blue2-BG" onclick="studentSaved(this, <%= JSON.stringify(behaviors) %>);">
                            <p>Save</p>
                            <div class="buttonIcon blue3-BG">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right column (students) -->
                <div class="lightGray2-BG heavyPadding width20 borderRadiusMedium">
                    <ul id="listOfStudents" class="studentsList" >
                    <% if (reports.length > 0) { %>
                        <script>passToJS(<%- JSON.stringify(reports) %>);</script>
                        <% reports.forEach((report, index) => { %>
                            <li id="student<%= index %>" onclick="showStudentData(this, <%= JSON.stringify(report) %>, <%= index %>)"><%= report.name %></li>
                        <% }) %>
                    <% } else { %>
                        <li>No Students</li>
                    <% } %>
                    </ul>
                </div>
                    
            </div>

            <div id="stepThree" class="flex spaceAround displayNone width100">
                <div class="width70 lightGray2-BG borderRadiusMedium">

                </div>
                <div class="lightGray2-BG heavyPadding width20 borderRadiusMedium">
                    <ul id="listOfStudents" class="studentsList" >
                    <% if (reports.length > 0) { %>
                        <script>passToJS(<%- JSON.stringify(reports) %>);</script>
                        <% reports.forEach((report, index) => { %>
                            <li id="student<%= index %>" onclick="showStudentData(this, <%= JSON.stringify(report) %>, <%= index %>)"><%= report.name %></li>
                        <% }) %>
                    <% } else { %>
                        <li>No Students</li>
                    <% } %>
                    </ul>
                </div>
            </div>
            <div onclick="toNextStep()" class="sideButton"><i id="nextButton" class="fas fa-chevron-right"></i></div>
        </div>
        <script>initEmailerVariables();
        
        $(document).ready(function(){
            $('select').selectmenu();
        })
            
        </script>

        <script>
            var listOfReminders = <%- JSON.stringify(reminders) %>;
            var numRemindersShown = 0;
            function addReminder(){
                numRemindersShown++;
                var reminders = document.getElementById('reminders');
                var select = document.createElement("select");
                for(var i = 0; i < listOfReminders.length; i++){
                    var option = document.createElement("option");
                    option.text = listOfReminders[i].title;

                    select.appendChild(option);
                }

                var label = document.createElement("label");
                label.innerHTML = "Reminder " + numRemindersShown;
                label.classList = "darkText";
                var li = document.createElement("li");
                li.classList = "flex spaceBetween flexAlignCenter lightPadding";
                li.appendChild(label);
                li.appendChild(select);
                reminders.appendChild(li);
                
                $('select').selectmenu();
            }

        </script>
        
    </body>
</html>